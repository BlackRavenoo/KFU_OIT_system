<script lang="ts">
    import { onMount, onDestroy } from 'svelte';
    import { fly } from 'svelte/transition';
    import { pageTitle, pageDescription } from '$lib/utils/setup/stores';
    
    interface FAQItem {
        question: string;
        answer: string;
        isOpen: boolean;
    }
    
    interface FAQCategory {
        title: string;
        items: FAQItem[];
    }
    
    let faqCategories: FAQCategory[] = [
        {
            title: "Общие вопросы о системе",
            items: [
                {
                    question: "Что такое система управления заявками ЕИ КФУ?",
                    answer: "Система управления заявками ЕИ КФУ — это цифровая платформа, созданная для оперативной обработки и отслеживания технических запросов от сотрудников и студентов Елабужского института Казанского Федерального Университета, а также сбора базы знаний с целью ускорения процесса решения технических проблем. Она позволяет централизованно управлять всеми заявками на техническую поддержку, ремонт оборудования и решение других ИТ-задач.",
                    isOpen: false
                },
                {
                    question: "Кто может пользоваться системой?",
                    answer: "Системой могут пользоваться все сотрудники и студенты Елабужского института КФУ. Доступ к административным функциям и просмотру архива заявок имеют только авторизованные сотрудники ИТ-отдела. Кроме того, оставлятзаявки в системе можно посредством ботов в Telegram, WhatsApp и иных мессенджерах, что упрощает процесс подачи запросов.",
                    isOpen: false
                },
                {
                    question: "Нужно ли устанавливать дополнительное ПО для использования системы?",
                    answer: "Нет, система работает через веб-браузер и не требует установки дополнительного программного обеспечения. Вы можете использовать любой современный браузер (Google Chrome, Mozilla Firefox, Microsoft Edge, Safari).",
                    isOpen: false
                }
            ]
        },
        {
            title: "Создание заявок",
            items: [
                {
                    question: "Как создать новую заявку?",
                    answer: "Для создания новой заявки необходимо нажать кнопку «Создать заявку» на главной странице, заполнить форму с описанием проблемы, указать местоположение и отправить заявку. После этого Ваша заявка появится в системе и будет назначена ответственному специалисту.",
                    isOpen: false
                },
                {
                    question: "Что указывать в заявке?",
                    answer: "Для эффективного решения вашей проблемы, пожалуйста, указывайте подробное описание проблемы и местоположение (здание, аудитория и т.д.). В некоторых случаях специалистам может потребоваться связаться с Вами, на этот случай система также запросит Ваши контактные данные. Кроме того, Вы также можете приложить к заявке фото (например, экран ошибки или фото Вашего принтера). Чем больше информации Вы предоставите, тем быстрее специалисты смогут помочь Вам.",
                    isOpen: false
                },
                {
                    question: "Когда выполнят мою заявку?",
                    answer: "Сотрудники ИТ-отдела стараются обрабатывать заявки в порядке очереди. Время выполнения зависит от сложности проблемы и текущей загруженности специалистов. Вы можете узнать загруженность отдела на данный момент в разделе статистики на главной странице сайта.",
                    isOpen: false
                }
            ]
        },
        {
            title: "Учетные записи и авторизация",
            items: [
                {
                    question: "Как зарегистрироваться в системе?",
                    answer: "Регистрация в системе доступна только сотрудникам ИТ-отдела Елабужского института. Ссылка на регистрацию придёт Вам на почту после того, как администратор отправит приглашение. Для остальных сотрудников и студентов регистрация не требуется.",
                    isOpen: false
                },
                {
                    question: "Что делать, если я забыл пароль?",
                    answer: "На странице входа нажмите кнопку «Забыли пароль?» и следуйте инструкциям для восстановления доступа. На указанный при регистрации email будет отправлена ссылка для сброса пароля.",
                    isOpen: false
                },
                {
                    question: "Как изменить данные своего профиля?",
                    answer: "Войдите в систему и перейдите в раздел «Личный кабинет». Нажмите кнопку «Редактировать профиль», внесите необходимые изменения и сохраните их. Обратите внимание, что некоторые данные могут быть недоступны для редактирования.",
                    isOpen: false
                }
            ]
        }
    ];
    
    /**
     * Переключение состояния FAQ (открыт/закрыт)
     * @param categoryIndex Номер категории
     * @param itemIndex Номер вопроса в категории
     */
    function toggleFAQ(categoryIndex: number, itemIndex: number) {
        faqCategories[categoryIndex].items[itemIndex].isOpen = !faqCategories[categoryIndex].items[itemIndex].isOpen;
        faqCategories = [...faqCategories];
    }
    
    /**
     * Установка мета-тегов страницы при монтировании
    */
    onMount(() => {
        pageTitle.set('Часто задаваемые вопросы | Система управления заявками ЕИ КФУ');
        pageDescription.set('Ответы на часто задаваемые вопросы по использованию системы управления заявками Елабужского института Казанского Федерального Университета.');
    });
    
    /**
     * Сброс мета-тегов страницы при размонтированииы
    */
    onDestroy(() => {
        pageTitle.set('ОИТ | Система управления заявками ЕИ КФУ');
        pageDescription.set('Система обработки заявок Отдела Информационных Технологий Елабужского института Казанского Федерального Университета.');
    });
</script>

<div class="faq-page" in:fly={{ y: 30, duration: 800, delay: 300 }}>
    <div class="faq-container">
        <h1>Часто задаваемые <span class="gradient-text">вопросы</span></h1>
        
        <div class="faq-intro">
            <p>
                Мы собрали наиболее часто встречающиеся вопросы о работе системы управления заявками Елабужского института КФУ. 
                Если вы не нашли ответ на свой вопрос, пожалуйста, свяжитесь с нашей 
                <a href="/contact" class="gradient-link">службой поддержки</a>.
            </p>
        </div>
        
        {#each faqCategories as category, categoryIndex}
            <div class="faq-section">
                <h2>{ category.title }</h2>
                
                <div class="faq-items">
                    {#each category.items as item, itemIndex}
                        <div class="faq-item">
                            <button 
                                class="faq-question { item.isOpen ? 'active' : '' }"
                                on:click={ () => toggleFAQ(categoryIndex, itemIndex) }
                                aria-expanded={ item.isOpen }
                                aria-controls="faq-answer-{ categoryIndex }-{ itemIndex }"
                            >
                                { item.question }
                                <span class="faq-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d={ item.isOpen ? "M18 15l-6-6-6 6" : "M6 9l6 6 6-6" }></path>
                                    </svg>
                                </span>
                            </button>
                            
                            {#if item.isOpen}
                                <div 
                                    class="faq-answer"
                                    id="faq-answer-{ categoryIndex }-{ itemIndex }"
                                    transition:fly={ { y: -10, duration: 200 } }
                                >
                                    <p>{ item.answer }</p>
                                </div>
                            {/if}
                        </div>
                    {/each}
                </div>
            </div>
        {/each}
        
        <div class="faq-cta">
            <p>У вас остались вопросы?</p>
            <a href="/contact" class="cta-button">Связаться с нами</a>
        </div>
    </div>
</div>

<style>
    @import './page.css';
</style>